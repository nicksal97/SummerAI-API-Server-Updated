<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <title>TREE PROJECT</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <style>
    .overlay {
      display: none;
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 999;
      background: rgba(255,255,255,0.8) url("{% static 'loader/loading.gif' %}") center no-repeat;
    }
    body {
      text-align: center;
    }
    body.loading {
      overflow: hidden;
    }
    body.loading .overlay {
      display: block;
    }
    .ScrollStyle {
      max-height: 335px;
      overflow-y: scroll;
    }
  </style>
</head>
<body>
<div class="overlay"></div>

<!-- Top navigation bar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand btn btn-primary text-white mr-2" href="{% url 'index' %}">Home</a>
  <a class="navbar-brand btn btn-success text-white mr-2" href="{% url 'model-upload' %}">Upload Model</a>
  <div class="ml-auto">
    <a href="{% url 'logout' %}" class="btn btn-outline-danger">Logout</a>
  </div>
</nav>

<div class="container">
  <form id="myForm">
    <h1 class="text-center">Upload Model</h1><br><br>
    <div class="form-group">
      <label for="model">Select Model Type:</label>
      <select class="form-control" id="model" name="model">
        <option value="winter">Winter</option>
        <option value="summer">Summer</option>
      </select>
    </div>
    <div class="form-group">
      <label>Select Model Path:</label>
      <input type="file" class="form-control" id="model_path" name="file" accept=".pt">
    </div>

    <button type="button" class="btn btn-primary" onclick="myFunction()">Submit</button>
  </form>
  <br>
  <br>

  <!-- Display list of files for Summer -->
  <h3>Files in Summer Models Directory</h3>
  <ul id="summer-file-list" class="list-group">
    {% for item in summer_path %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ item }}
        <button class="btn btn-danger btn-sm" onclick="deleteFile('{{ item }}', 'summer')">Delete</button>
      </li>
    {% empty %}
      <li class="list-group-item">No files found in Summer directory</li>
    {% endfor %}
  </ul>

  <br>

  <!-- Display list of files for Winter -->
  <h3>Files in Winter Models Directory</h3>
  <ul id="winter-file-list" class="list-group">
    {% for item in winter_path %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ item }}
        <button class="btn btn-danger btn-sm" onclick="deleteFile('{{ item }}', 'winter')">Delete</button>
      </li>
    {% empty %}
      <li class="list-group-item">No files found in Winter directory</li>
    {% endfor %}
  </ul>
</div>

<script>
  $(document).ready(function() {
    $("#main_container").hide();
  });

  function myFunction() {
    var model_path = $("#model_path").prop('files')[0];
    var selected_model = $("#model").val();
    if (model_path == undefined) {
      alert("Please select the model path");
    } else {
      var form_data = new FormData();
      form_data.append("model_path", model_path);
      form_data.append("model", selected_model);
      $.ajax({
        url: "/model-upload/",
        type: "POST",
        data: form_data,
        contentType: false,
        processData: false,
        beforeSend: function() {
          $("body").addClass("loading");
        },
        success: function() {
          console.log("abc");
        },
        complete: function(result) {
          $("body").removeClass("loading");
          $('#myForm')[0].reset();

          var flag = result['responseJSON']['status'];
          if (flag == true) {
            alert("Model Upload Successfully");
          } else {
            alert("Please send a valid model path");
          }
        }
      });
    }
  }

  function deleteFile(filename, type) {
    if (confirm("Are you sure you want to delete " + filename + "?")) {
      $.ajax({
        url: "{% url 'delete-file' %}",
        type: "POST",
        data: {
          'filename': filename,
          'type': type,
          'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
          if (response.success) {
            alert(filename + " deleted successfully.");
            location.reload();  // Reload the page to update the file list
          } else {
            alert("Error deleting file: " + response.error);
          }
        },
        error: function() {
          alert("An error occurred. Please try again.");
        }
      });
    }
  }
</script>
</body>
</html>
